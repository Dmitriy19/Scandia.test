// tooling
const postcss = require('postcss');

// plugin
module.exports = postcss.plugin('postcss-font-family-system-ui', () => root => {
    // update declarations to polyfill system-ui font-family values
    root.walkDecls(fontPropertyMatch, decl => {
      decl.value = decl.value.replace(systemUiMatch, `$1${systemUiString}$2`);
    });
});

// system-ui fallbacks
const systemUiFamily = [
  'system-ui',
  '-apple-system',
  'BlinkMacSystemFont',
  'Segoe UI',
  'Roboto',
  'Oxygen',
  'Ubuntu',
  'Cantarell',
  'Fira Sans',
  'Droid Sans',
  'Helvetica Neue'
];

// system-ui with fallbacks match
const systemUiMatch = new RegExp(`(^|,|\\s)(?:\\s*system-ui\\s*)(?:,\\s*(?:${systemUiFamily.join('|')})\\s*)?(,|$)`, 'i');

// system-ui fallbacks as a string
const systemUiString = systemUiFamily.join(', ');

// font and font family property match
const fontPropertyMatch = /^font(-family)?$/i;
